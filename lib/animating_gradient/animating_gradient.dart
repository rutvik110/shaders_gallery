import 'dart:convert';
import 'dart:typed_data';

import 'dart:ui';

import 'package:umbra_flutter/umbra_flutter.dart';

/// {@template animating_gradient}
/// A Dart Shader class for the `animating_gradient` shader.
/// {@endtemplate}
class AnimatingGradient extends UmbraShader {
  AnimatingGradient._() : super(_cachedProgram!);

  /// {@macro animating_gradient}
  static Future<AnimatingGradient> compile() async {
    try {
      // Caching the program on the first compile call.
      _cachedProgram ??= await FragmentProgram.compile(
        spirv: Uint8List.fromList(base64Decode(_spirv)).buffer,
      );

      return AnimatingGradient._();
    } on Exception catch (err, stackTrace) {
      throw UmbraException(err, stackTrace);
    }
  }

  static FragmentProgram? _cachedProgram;

  Shader shader({
    required Size resolution,
    required double uTime,
    required Vector2 uResolution,
  }) {
    return program.shader(
      floatUniforms: Float32List.fromList([
        uTime,
        uResolution.x,
        uResolution.y,
        resolution.width,
        resolution.height,
      ]),
      samplerUniforms: [],
    );
  }
}

const _spirv =
    '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';

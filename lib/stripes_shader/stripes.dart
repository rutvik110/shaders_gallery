import 'dart:convert';
import 'dart:typed_data';

import 'dart:ui';

import 'package:umbra_flutter/umbra_flutter.dart';

/// {@template stripes}
/// A Dart Shader class for the `stripes` shader.
/// {@endtemplate}
class Stripes extends UmbraShader {
  Stripes._() : super(_cachedProgram!);

  /// {@macro stripes}
  static Future<Stripes> compile() async {
    try {
      // Caching the program on the first compile call.
      _cachedProgram ??= await FragmentProgram.compile(
        spirv: Uint8List.fromList(base64Decode(_spirv)).buffer,
      );

      return Stripes._();
    } on Exception catch (err, stackTrace) {
      throw UmbraException(err, stackTrace);
    }
  }

  static FragmentProgram? _cachedProgram;

  Shader shader({
    required Size resolution,
    required double uTime,
    required double tiles,
    required double speed,
    required double direction,
    required double warpScale,
    required double warpTiling,
    required Vector3 color1,
    required Vector3 color2,
  }) {
    return program.shader(
      floatUniforms: Float32List.fromList([
        uTime,
        tiles,
        speed,
        direction,
        warpScale,
        warpTiling,
        color1.x,
        color1.y,
        color1.z,
        color2.x,
        color2.y,
        color2.z,
        resolution.width,
        resolution.height,
      ]),
      samplerUniforms: [],
    );
  }
}

const _spirv =
    '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';
